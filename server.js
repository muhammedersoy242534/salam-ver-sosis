
const Discord = require('discord.js');
const client = new Discord.Client();
const ayarlar = require('./ayarlar.json');
const chalk = require('chalk');
const fs = require('fs');
const moment = require('moment');
const db = require('quick.db');
const Jimp = require('jimp');
let hereEngel = JSON.parse(fs.readFileSync("././jsonlar/hereEngelle.json", "utf8"));
let linkEngel = JSON.parse(fs.readFileSync("././jsonlar/linkEngelle.json", "utf8"));
require('./util/eventLoader')(client);
var prefix = ayarlar.prefix;
const log = message => {
console.log(`[${moment().format('YYYY-MM-DD HH:mm:ss')}] ${message}`);
};
client.commands = new Discord.Collection();
client.aliases = new Discord.Collection();
fs.readdir('./komutlar/', (err, files) => {
if (err) console.error(err);
log(`${files.length} komut yÃ¼klenecek.`);
files.forEach(f => {
let props = require(`./komutlar/${f}`);
log(`YÃ¼klenen komut: ${props.help.name}.`);
client.commands.set(props.help.name, props);
props.conf.aliases.forEach(alias => {
client.aliases.set(alias, props.help.name);
});
});
});

client.reload = command => {
return new Promise((resolve, reject) => {
try {
delete require.cache[require.resolve(`./komutlar/${command}`)];
let cmd = require(`./komutlar/${command}`);
client.commands.delete(command);
client.aliases.forEach((cmd, alias) => {
if (cmd === command) client.aliases.delete(alias);
});
client.commands.set(command, cmd);
cmd.conf.aliases.forEach(alias => {
client.aliases.set(alias, cmd.help.name);
});
resolve();
} catch (e){
reject(e);
}
});
};

client.load = command => {
return new Promise((resolve, reject) => {
try {
let cmd = require(`./komutlar/${command}`);
client.commands.set(command, cmd);
cmd.conf.aliases.forEach(alias => {
client.aliases.set(alias, cmd.help.name);
});
resolve();
} catch (e){
reject(e);
}
});
};

client.unload = command => {
return new Promise((resolve, reject) => {
try {
delete require.cache[require.resolve(`./komutlar/${command}`)];
let cmd = require(`./komutlar/${command}`);
client.commands.delete(command);
client.aliases.forEach((cmd, alias) => {
if (cmd === command) client.aliases.delete(alias);
});
resolve();
} catch (e){
reject(e);
}
});
};

client.elevation = message => {
if(!message.guild) {
	return; }
let permlvl = 0;
if (message.member.hasPermission("BAN_MEMBERS")) permlvl = 2;
if (message.member.hasPermission("ADMINISTRATOR")) permlvl = 3;
if (message.author.id === ayarlar.sahip) permlvl = 4;
return permlvl;
};

var regToken = /[\w\d]{24}\.[\w\d]{6}\.[\w\d-_]{27}/g;

client.on('warn', e => {
console.log(chalk.bgYellow(e.replace(regToken, 'SAGARÄ°S ATLADI')));
});

client.on('error', e => {
console.log(chalk.bgRed(e.replace(regToken, 'SAGARÄ°S ATLADI')));
});



/////////////////////MOD LOG////////////////////////////
client.on('guildBanAdd', async (guild, member) => {
const embed = new Discord.RichEmbed()
.setTitle('Ãœye yasaklandÄ±.')
.setColor("#36393E")
.setDescription(`<@${member.user.id}> adlÄ± kullanÄ±cÄ± yasaklandÄ±!`)
.setThumbnail(member.user.avatarURL || member.user.defaultAvatarURL)
.setFooter(`Yasaklanan KullanÄ±cÄ± ID: ${member.user.id}`)
.setTimestamp();
let membermodChannel = await db.fetch(`membermodChannel_${guild.id}`)
if (!guild.channels.get(membermodChannel)) return console.log('membermodChannel')
else guild.channels.get(membermodChannel).send(embed)


})


.on('messageUpdate', async (oldMessage, newMessage) => {
if (oldMessage.author.bot) {
return false;
}

if (!oldMessage.guild) {
return false;
}

if (oldMessage.content == newMessage.content) {
return false;
}

if (!oldMessage || !oldMessage.id || !oldMessage.content || !oldMessage.guild) return;
let embedds4 = new Discord.RichEmbed()
.setColor("#0080ff")
.setAuthor(`Mesaj GÃ¼ncellendi!`)
.setThumbnail(oldMessage.author.avatarURL)
.addField("GÃ¶nderen", oldMessage.author.tag, true)
.addField("Ã–nceki Mesaj", `\`\`\`${oldMessage.content}\`\`\``, true)
.addField("Åimdiki Mesaj", `\`\`\`${newMessage.content}\`\`\``, true)
.addField("Kanal", newMessage.channel.name, true)
.setFooter(` Imam-Bot Log Sistemi | ID: ${client.user.id}`)
let membermodChannel = await db.fetch(`membermodChannel_${oldMessage.guild.id}`)
if (!oldMessage.guild.channels.get(membermodChannel)) return console.log('membermodChannel')
else oldMessage.guild.channels.get(membermodChannel).send(embedds4)
})

client.on('guildBanRemove', async (guild, member) => {
let embedds6 = new Discord.RichEmbed()
.setColor("#0080ff")
.settitle(`Yasak KaldÄ±rÄ±ldÄ±!`)
.setThumbnail(member.avatarURL)
.setDescription(`'${member.tag}' adlÄ± kiÅŸinin yasaÄŸÄ± kaldÄ±rÄ±ldÄ±.`, true)
let membermodChannel = await db.fetch(`membermodChannel_${guild.id}`)
if (!guild.channels.get(membermodChannel)) return console.log('membermodChannel')
else guild.channels.get(membermodChannel).send(embedds6)
})

.on('messageDelete', async msg => {

var embed = new Discord.RichEmbed()
.setAuthor(msg.author.tag, msg.author.avatarURL)
.setColor("BLUE")
.setDescription(`<@!${msg.author.id}> tarafÄ±ndan <#${msg.channel.id}> kanalÄ±na gÃ¶nderilen \`\`\`${msg.content}\`\`\` mesajÄ± silindi.`)
.setFooter(`Imam-Bot Log Sistemi | ID: ${msg.id}`)
let membermodChannel = await db.fetch(`membermodChannel_${msg.guild.id}`)
if (!msg.guild.channels.get(membermodChannel)) return console.log('Mesaj Silindi')
else msg.guild.channels.get(membermodChannel).send(embed) 

})
.on('roleDelete', async role => {
const fs = require('fs');
let embed = new Discord.RichEmbed()
.setColor("BLUE")
.setAuthor(`Rol Silindi!`)
.setDescription(`'${role.name}' adlÄ± rol silindi.`, true)
.setFooter(`Imam-Bot Log Sistemi | ID: ${role.id}`)
let membermodChannel = await db.fetch(`membermodChannel_${role.guild.id}`)
if (!role.guild.channels.get(membermodChannel)) return console.log('Mesaj Silindi')
else role.guild.channels.get(membermodChannel).send(embed) 
})
.on('roleCreate', async role => {
const fs = require('fs');
let embed = new Discord.RichEmbed()
.setColor("BLUE")
.setAuthor(`Rol OluÅŸturuldu!`)
.setDescription(`'${role.name}' adlÄ± rol oluÅŸturuldu.`, true)
.setFooter(`Imam-Bot Log Sistemi | ID: ${role.id}`)
let membermodChannel = await db.fetch(`membermodChannel_${role.guild.id}`)
if (!role.guild.channels.get(membermodChannel)) return console.log('Mesaj Silindi')
else role.guild.channels.get(membermodChannel).send(embed) 
})
.on('emojiCreate', async emoji => {
const fs = require('fs');
let embed = new Discord.RichEmbed()
.setColor("BLUE")
.setAuthor(`Emoji OluÅŸturuldu!`)
.setDescription(`<:${emoji.name}:${emoji.id}> - ${emoji.name} adlÄ± emoji oluÅŸturuldu!`, true)
.setFooter(`Imam-Bot Log Sistemi | ID: ${emoji.id}`)
let membermodChannel = await db.fetch(`membermodChannel_${emoji.guild.id}`)
if (!emoji.guild.channels.get(membermodChannel)) return console.log('YazÄ± Kanal OluÅŸturuldu')
else emoji.guild.channels.get(membermodChannel).send(embed) 
})

.on('emojiDelete', async emoji => {
const fs = require('fs');

let embed = new Discord.RichEmbed()
.setColor("BLUE")
.setAuthor(`Emoji Silindi!`)
.setDescription(`':${emoji.name}:' adlÄ± emoji silindi!`, true)
	.setFooter(`Imam-Bot Log Sistemi | ID: ${emoji.id}`)
let membermodChannel = await db.fetch(`membermodChannel_${emoji.guild.id}`)
if (!emoji.guild.channels.get(membermodChannel)) return console.log('YazÄ± Kanal OluÅŸturuldu')
else emoji.guild.channels.get(membermodChannel).send(embed) 
})
.on('channelCreate', async channel => {


if (channel.type === "text") {
var embed = new Discord.RichEmbed()
.setColor("BLUE")
.setAuthor(channel.guild.name, channel.guild.iconURL)
.setDescription(`<#${channel.id}> kanalÄ± oluÅŸturuldu. _(metin kanalÄ±)_`)
.setFooter(`Boss Bot Log Sistemi | ID: ${channel.id}`)
let membermodChannel = await db.fetch(`membermodChannel_${channel.guild.id}`)
if (!channel.guild.channels.get(membermodChannel)) return console.log('YazÄ± Kanal OluÅŸturuldu')
else channel.guild.channels.get(membermodChannel).send(embed) 
};
if (channel.type === "voice") {
var embed = new Discord.RichEmbed()
.setColor("BLUE")
.setAuthor(channel.guild.name, channel.guild.iconURL)
.setDescription(`${channel.name} kanalÄ± oluÅŸturuldu. _(sesli kanal)_`)
.setFooter(`Boss Bot Log Sistemi | ID: ${channel.id}`)
let membermodChannel = await db.fetch(`membermodChannel_${channel.guild.id}`)
if (!channel.guild.channels.get(membermodChannel)) return console.log('Ses KanalÄ± OluÅŸturuldu')
else channel.guild.channels.get(membermodChannel).send(embed) }
})

.on('channelDelete', async channel => {
if (channel.type === "text") {
let embed = new Discord.RichEmbed()
.setColor("BLUE")
.setAuthor(channel.guild.name, channel.guild.iconURL)
.setDescription(`${channel.name} kanalÄ± silindi. _(metin kanalÄ±)_`)
.setFooter(`Boss Bot' Log Sistemi | ID: ${channel.id}`)
let membermodChannel = await db.fetch(`membermodChannel_${channel.guild.id}`)
if (!channel.guild.channels.get(membermodChannel)) return console.log('YazÄ± KanalÄ± Silindi')
else channel.guild.channels.get(membermodChannel).send(embed)
};
if (channel.type === "voice") {
let embed = new Discord.RichEmbed()
.setColor("BLUE")
.setAuthor(channel.guild.name, channel.guild.iconURL)
.setDescription(`${channel.name} kanalÄ± silindi. _(sesli kanal)_`)
.setFooter(`Imam-Bot Log Sistemi | ID: ${channel.id}`)
let membermodChannel = await db.fetch(`membermodChannel_${channel.guild.id}`)
if (!channel.guild.channels.get(membermodChannel)) return console.log('Ses KanalÄ± Silindi')
else channel.guild.channels.get(membermodChannel).send(embed) }

});


///////////////////KÃœFÃœR ENGELLEME///////////////////////
client.on("message", async msg => {
db.fetch(`kufur_${msg.guild.id}`).then(i => {
if (i == 'AÃ§Ä±k') {
const kufur = ["fuck", "FUCK", "SHIT", "shit", "PORN", "porn", "xnxx", "XNXX","amk","aq","sik","siktir","aq","amk","oÃ§","oruspu","orusbu","anan","sikerler","sikerim","s1kerler","s1kerim","s1ker1m","wtf","AMK","AQ","ORUSBU","ORUSPU","SÄ°KERLER",,"GAY","GÃ–T","ANAN","PORNHUB.COM","pornhub.com","brazzers","BRAZZERS","ANANI","ananÄ±","ananÄ± sikerim","ananÄ± sik","anamÄ± sik","ANANI SÄ°K","ANANI SÄ°KERÄ°M","ÅŸerefsiz","Åerefsiz","ÅEREFSÄ°Z","orospu","orospu Ã§ocuÄŸu","OC","PiÃ§","PÄ°Ã‡","yavÅŸak","YAVÅAK","ibne","ipne","Ä°BNE","Ä°PNE","amÄ±na korum","pi.Ã§","piÃ§"];
if (kufur.some(word => msg.content.includes(word))) {
try {
if (!msg.member.hasPermission("BAN_MEMBERS")) {
msg.delete();

return msg.reply(`KÃ¼fÃ¼r Tespit Edildi! ${ayarlar.uyarÄ±}`).then(msg => msg.delete(3000));
} 
} catch(err) {
console.log(err);
}
} } else if (i == 'KapalÄ±') {

}

})
});


/////////////////////////REKLAM ENGELLEME/////////////////////////
client.on("message", msg => {
  db.fetch(`reklam_${msg.guild.id}`).then(i => {
    if (i == 'acik') {
        const reklam = [".com", ".net", ".xyz", ".tk", ".pw", ".io", ".me", ".gg", "www.", "https", "http", ".gl", ".org", ".com.tr", ".biz", "net", ".rf.gd", ".az", ".party", "discord.gg",];
        if (reklam.some(word => msg.content.includes(word))) {
          try {
            if (!msg.member.hasPermission("BAN_MEMBERS")) {
                  msg.delete();
                    return msg.reply('Bu Sunucuda Reklam Engelleme Filtresi Aktiftir. Reklam Yapmana Ä°zin Veremem !').then(msg => msg.delete(3000));
    

  msg.delete(3000);                              

            }              
          } catch(err) {
            console.log(err);
          }
        }
    }
    else if (i == 'kapali') {
      
    }
    if (!i) return;
  })
    });

////////////////////////EVERYONE ENGELLEME///////////////////

});


///////////////////////////SEVÄ°YE SÄ°STEMÄ°////////////////////////////
client.on("message", async msg => {

if (msg.channel.type === "dm") return;
if(msg.author.bot) return; 

if (msg.content.length > 7) {

db.add(`puan_${msg.author.id + msg.guild.id}`, 3)
};

if (db.fetch(`puan_${msg.author.id + msg.guild.id}`) > 150) {

db.add(`seviye_${msg.author.id + msg.guild.id}`, 1)

db.delete(`puan_${msg.author.id + msg.guild.id}`)

};

});

/////////////////////SUNUCU KURMA/////////////////////
client.on('message', async message => {
const ms = require('ms');
const args = message.content.slice(prefix.length).trim().split(/ +/g);
const command = args.shift().toLowerCase();
let u = message.mentions.users.first() || message.author;
if (command === "sunucu-kur") {
if (message.guild.channels.find(channel => channel.name === "Bot KullanÄ±mÄ±")) return message.channel.send(" Bot Paneli Zaten AyarlanmÄ±ÅŸ.")
message.channel.send(`Bot Bilgi KanallarÄ±nÄ±n kurulumu baÅŸlatÄ±lsÄ±n mÄ±? baÅŸlatÄ±lacak ise **evet** yazÄ±nÄ±z.`)
if (!message.member.hasPermission('ADMINISTRATOR'))
return message.channel.send(" Bu Kodu `YÃ¶netici` Yetkisi Olan KiÅŸi Kullanabilir.");
message.channel.awaitMessages(response => response.content === 'evet', {
max: 1,
time: 10000,
errors: ['time'],
})


.then((collected) => {
message.guild.createChannel('ğŸ“œâ”‚Bilgilendirme.', 'category', [{
id: message.guild.id,
deny: ['SEND_MESSAGES']
}])

client.on('guildMemberAdd', async member => {
let rol = await db.fetch(`otorol_${member.guild.id}`)
db.fetch(`otorolkanal_${member.guild.id}`).then(async i => {
const channel = member.guild.channels.get(i)
if (!i) return;
let guild = member.guild;
let otorol = guild.roles.find('name', `${rol}`);
member.addRole(otorol);
channel.send(`**${member.user.tag}** adlÄ± kullanÄ±cÄ±ya \`${rol}\` adlÄ± rol verildi!`)
})
});


message.guild.createChannel('ğŸ“Œâ”‚ĞºÏ…ÑÎ±llÎ±Ñ', 'text', [{
id: message.guild.id,
deny: ['SEND_MESSAGES']
}])
.then(channel =>
channel.setParent(message.guild.channels.find(channel => channel.name === "ğŸ“œâ”‚Bilgilendirme.")));
message.guild.createChannel('ğŸºâ”‚gÄ±ÑÄ±Ñ•-Ã§Ä±ĞºÄ±Ñ•', 'text', [{
id: message.guild.id,
deny: ['SEND_MESSAGES']
}])
.then(channel =>
channel.setParent(message.guild.channels.find(channel => channel.name === "ğŸ“œâ”‚Bilgilendirme.")));
message.guild.createChannel('ğŸ’¥â”‚Ñ•Î±Ñ‡Î±Ã§', 'text', [{
id: message.guild.id,
deny: ['SEND_MESSAGES']
}])
.then(channel =>
channel.setParent(message.guild.channels.find(channel => channel.name === "ğŸ“œâ”‚Bilgilendirme.")));
message.guild.createChannel('ğŸ“Šâ”‚Î±Ğ¸ĞºÎµÑ‚', 'text', [{
id: message.guild.id,
deny: ['SEND_MESSAGES']
}])
.then(channel => channel.setParent(message.guild.channels.find(channel => channel.name === "ğŸ“œâ”‚Bilgilendirme.")));
message.guild.createChannel('ğŸ“£â”‚dÏ…Ñ‡Ï…ÑÏ…lÎ±Ñ', 'text', [{
id: message.guild.id,
deny: ['SEND_MESSAGES']
}])
.then(channel =>
channel.setParent(message.guild.channels.find(channel => channel.name === "ğŸ“œâ”‚Bilgilendirme.")));

})
.then((collected) => {
message.guild.createChannel('âš¡â”‚Ana. Kanallar.', 'category', [{
id: message.guild.id,
}]);

message.guild.createChannel(`ğŸŒºâ”‚Ñ‚Î±vsÄ±yÎµ`, 'text')
.then(channel =>
channel.setParent(message.guild.channels.find(channel => channel.name === "âš¡â”‚Ana. Kanallar.")));
message.guild.createChannel(`ğŸŒ™â”‚Ïƒzlu-Ñ•ÏƒzlÎµÑ`, 'text')
.then(channel =>
channel.setParent(message.guild.channels.find(channel => channel.name === "âš¡â”‚Ana. Kanallar.")));
message.guild.createChannel(`ğŸ“·â”‚fÏƒÑ‚ÏƒÄŸÑÎ±flÎ±Ñ`, 'text')
.then(channel =>
channel.setParent(message.guild.channels.find(channel => channel.name === "âš¡â”‚Ana. Kanallar.")));
message.guild.createChannel(`ğŸ¤–â”‚Ğ²ÏƒÑ‚-ĞºÏƒĞ¼Ï…Ñ‚lÎ±ÑÄ±`, 'text')
.then(channel =>
channel.setParent(message.guild.channels.find(channel => channel.name === "âš¡â”‚Ana. Kanallar.")));
message.guild.createChannel(`ğŸ’­â”‚gÎµĞ¸Îµl-Ñ•ÏƒĞ½Ğ²ÎµÑ‚`, 'text')
.then(channel =>
channel.setParent(message.guild.channels.find(channel => channel.name === "âš¡â”‚Ana. Kanallar.")));

message.guild.createChannel(`âœ¯ â”‚ÅÃ˜RÃ. &`, "voice")
.then(channel =>
channel.setParent(message.guild.channels.find(channel => channel.name === "ğŸ† â”‚ Yetkili KatÄ±")))
.then(c => {
let role = message.guild.roles.find("name", "@everyone");
let role2 = message.guild.roles.find("name", "â« Kurucu ğŸŒ¹");

c.overwritePermissions(role, {
CONNECT: true,
});
c.overwritePermissions(role2, {
CONNECT: true,

});
})

message.guild.createChannel('ğŸ† â”‚ Yetkili KatÄ±', 'category', [{
id: message.guild.id,
}]);

message.guild.createChannel(`ğŸ’®â”‚KÃ¢ptÃ¢n. &`, "voice")
.then(channel =>
channel.setParent(message.guild.channels.find(channel => channel.name === "ğŸ† â”‚ Yetkili KatÄ±")))
.then(c => {
let role = message.guild.roles.find("name", "@everyone");
let role2 = message.guild.roles.find("name", "â« Kurucu ğŸŒ¹");
let role3 = message.guild.roles.find("name", "â« Yonetici ğŸŒ¹");
c.overwritePermissions(role, {
CONNECT: true,
});
c.overwritePermissions(role2, {
CONNECT: true,
});
c.overwritePermissions(role3, {
CONNECT: true,
});
})

message.guild.createChannel(`â­â”‚Sohbet. â€ `, "voice")
.then(channel =>
channel.setParent(message.guild.channels.find(channel => channel.name === "ğŸ† â”‚ Yetkili KatÄ±")))
.then(c => {
let role = message.guild.roles.find("name", "@everyone");
c.overwritePermissions(role, {
CONNECT: true,
});
})

message.guild.createChannel(`â­â”‚Sohbet. â€ â€ `, "voice")
.then(channel =>
channel.setParent(message.guild.channels.find(channel => channel.name === "ğŸ† â”‚ Yetkili KatÄ±")))
.then(c => {
let role = message.guild.roles.find("name", "@everyone");
c.overwritePermissions(role, {
CONNECT: true,
});
})


message.guild.createRole({
name: 'âœ¯ â”‚ÅÃ˜RÃ. &',
color: 'ff0000',
permissions: [
"ADMINISTRATOR",
]
})


message.guild.createRole({
name: 'ğŸ’®â”‚KÃ¢ptÃ¢n. &',
color: '49ff00',
permissions: [
"MANAGE_GUILD",
"MANAGE_ROLES",
"MUTE_MEMBERS",
"DEAFEN_MEMBERS",
"MANAGE_MESSAGES",
"MANAGE_NICKNAMES",
"KICK_MEMBERS"
]
})

message.guild.createRole({
name: 'ğŸâ”‚YÃ¸netici. &',
color: 'ffb400',
permissions: [
"MANAGE_GUILD",
"MANAGE_ROLES",
"MUTE_MEMBERS",
"DEAFEN_MEMBERS",
"MANAGE_MESSAGES",
"MANAGE_NICKNAMES"
]
})

message.guild.createRole({
name: 'ğŸ’â”‚ÅÃ¢diÎµs. &',
color: 'd300ff',
})

message.guild.createRole({
name: 'ğŸ†â”‚BÃ¸ys. &',
color: 'ffffff',
})

message.guild.createRole({
name: 'ğŸ›¡ â”‚AuthorizÎµd. Bot. &',
color: '0006ff',
})

message.channel.send("â« Gerekli Roller Ve Odalar Kuruldu ğŸŒ¹")

})

}
});

//////////////////////TEMÄ°ZLE////////////////////////



client.login(ayarlar.token);